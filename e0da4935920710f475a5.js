(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{177:function(e,t,a){e.exports=a.p+"images/9367c563faf1e2ef8c39edd4e7cacdd1.svg"},178:function(e,t,a){e.exports=a.p+"images/33bce9168d45217acdba8d6b52a52ca7.svg"},179:function(e,t,a){e.exports=a.p+"images/be05ab98f5a880cf9a4ffc8a091ef71a.svg"},182:function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"container"},[e.showPopup?s("TalkToSpeakerPopup",{on:{close:function(t){e.showPopup=!1},question:function(t){e.actualQuestion=t}}},[s("ClonedVideo",{attrs:{isCameraOn:e.isCameraOn}}),s("VideoCheck",{attrs:{isCameraOn:e.isCameraOn},on:{toggleLocalCamera:e.toggleLocalCamera}}),s("StartStreamButton",{attrs:{title:"Готово"},on:{toggleRoom:e.togglePublish}})],1):e._e(),s("GuestHeader"),s("div",{staticClass:"speaker speaker_guest"},[s("div",{staticClass:"speaker__container speaker__container_guest"},[s("div",{staticClass:"speaker__wrapper-guest"},[s("h2",{staticClass:"speaker__heading"},[e._v("Спикер")]),s("div",{class:[e.hasSpeaker?"":"video-container_speaker","video-container"]},[e.hasSpeaker?e._e():s("p",{staticClass:"video-container__label"},[e._v("Диалог скоро начнётся")]),s("video",{ref:"speakerVideo",staticClass:"video-box video-box_guest",attrs:{id:"speakerVideo",autoplay:"",playsinline:""}})])]),s("div",{staticClass:"speaker__wrapper-guest"},[s("h2",{staticClass:"speaker__heading"},[e._v("Сейчас на связи")]),s("div",{directives:[{name:"show",rawName:"v-show",value:!e.isYourStreamStarted,expression:"!isYourStreamStarted"}],class:[e.hasGuest?"":"video-container_guest","video-container"]},[e.hasGuest?e._e():s("p",{staticClass:"video-container__label"},[e._v("Для начала диалога"),s("br"),e._v("задайте вопрос спикеру")]),s("video",{ref:"guestVideo",staticClass:"video-box video-box_guest",attrs:{id:"guestVideo",autoplay:"",playsinline:""}})]),s("div",{directives:[{name:"show",rawName:"v-show",value:e.isYourStreamStarted,expression:"isYourStreamStarted"}],class:[e.hasGuest?"video-container_guest":"","video-container"]},[s("video",{ref:"myVideo",staticClass:"video-box video-box_guest",attrs:{id:"myVideo",autoplay:"",muted:"",playsinline:""},domProps:{muted:!0}})]),s("div",{staticClass:"guest-questions guest-questions_guest"},[e.hasGuest?e._e():s("div",[e.isYourStreamStarted?e._e():s("button",{staticClass:"button",on:{click:e.showDialogWindow}},[e._v("Задать вопрос спикеру")])]),e.isYourStreamStarted?s("div",{staticClass:"guest-controls"},[s("div",{staticClass:"guest-controls__buttons"},[s("div",{class:[e.isMicOn?"":"guest-controls__item_disabled","guest-controls__item"],on:{click:e.toggleLocalMic}},[s("img",{attrs:{src:a(177)}})]),s("div",{class:[e.isCameraOn?"":"guest-controls__item_disabled","guest-controls__item"],on:{click:e.toggleLocalCamera}},[s("img",{attrs:{src:a(178)}})])]),s("div",{staticClass:"guest-controls__leave"},[s("button",{staticClass:"button button_red",on:{click:e.togglePublish}},[e._v("Выйти из диалога")])])]):e._e()])])])])],1)};s._withStripped=!0;a(88);var i=a(94),o=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"popup"},[s("div",{staticClass:"popup__container"},[s("div",{class:[e.videoCheck?"popup__window_check":"","popup__window"]},[s("img",{staticClass:"popup__close",attrs:{src:a(179),alt:"крестик"},on:{click:function(t){return e.$emit("close")}}}),s("div",{staticClass:"popup__wrapper"},[e.videoCheck?s("div",{staticClass:"popup__check-wrapper"},[s("p",{staticClass:"popup__title popup__title_check"},[e._v("Когда настанет ваша очередь вы подключитесь к видеочату со спикером. Настройте своё изображение.")]),e._t("default")],2):e._e(),e.videoCheck?e._e():s("div",[s("h1",{staticClass:"popup__header"},[e._v("Пообщаться со спикером")]),s("p",{staticClass:"popup__title"},[e._v("Заполните форму для того, чтобы встать в очередь и обсудить со спикером ваш вопрос")]),s("div",{staticClass:"form"},[s("form",{on:{submit:function(t){return t.preventDefault(),e.sendQuestion(t)}}},[s("div",{staticClass:"form__item"},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.name,expression:"name"}],staticClass:"form__input",attrs:{placeholder:"ФИО",type:"text",required:""},domProps:{value:e.name},on:{input:function(t){t.target.composing||(e.name=t.target.value)}}}),s("input",{directives:[{name:"model",rawName:"v-model",value:e.job,expression:"job"}],staticClass:"form__input",attrs:{placeholder:"Должность",type:"text",required:""},domProps:{value:e.job},on:{input:function(t){t.target.composing||(e.job=t.target.value)}}})]),s("div",{staticClass:"form__item"},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.company,expression:"company"}],staticClass:"form__input",attrs:{placeholder:"Компания",type:"text",required:""},domProps:{value:e.company},on:{input:function(t){t.target.composing||(e.company=t.target.value)}}}),s("input",{directives:[{name:"model",rawName:"v-model",value:e.email,expression:"email"}],staticClass:"form__input",attrs:{placeholder:"E-Mail",type:"email",required:""},domProps:{value:e.email},on:{input:function(t){t.target.composing||(e.email=t.target.value)}}})]),s("div",{staticClass:"form__item"},[s("textarea",{directives:[{name:"model",rawName:"v-model",value:e.question,expression:"question"}],staticClass:"form__text-input",attrs:{required:""},domProps:{value:e.question},on:{input:function(t){t.target.composing||(e.question=t.target.value)}}})]),e._m(0)])])])])])])])};o._withStripped=!0;var r={name:"TalkToSpeakerPopup",data:function(){return{videoCheck:!0,name:"",job:"",company:"",email:"",question:""}},methods:{sendQuestion:function(){this.$emit("question",this.question),this.videoCheck=!0}}},n=a(9),l=Object(n.a)(r,o,[function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"form__wrapper"},[t("p",{staticClass:"form__policy"},[this._v("Нажимая на кнопку «Задать вопрос» вы"),t("br"),this._v("соглашаетесь с "),t("span",[t("a",[this._v("политикой конфиденциальности")])])]),t("div",{staticClass:"form__button"},[t("button",{staticClass:"button"},[this._v("Задать вопрос")])])])}],!1,null,null,null);l.options.__file="src/components/TalkToSpeakerPopup.vue";var c=l.exports,d=a(107),u=a(108),m=function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"speaker__wrap speaker__wrap_initial"},[t("video",{ref:"video",staticClass:"video-box video-box_initial",attrs:{playsinline:"",muted:"",autoplay:""},domProps:{muted:!0}})])};m._withStripped=!0;a(87),a(89);var p={name:"ClonedVideo",props:["isCameraOn"],data:function(){return{video:{},isVideoActive:!0}},watch:{isCameraOn:{handler:function(){this.toggleCamera()}}},mounted:function(){this.startCameraStream()},destroyed:function(){this.stopCameraStream()},methods:{toggleCamera:function(){this.isVideoActive?this.stopCameraStream():this.startCameraStream()},startCameraStream:function(){var e=this;this.isVideoActive=!0;var t=window.constraints={audio:!1,video:!0};navigator.mediaDevices.getUserMedia(t).then((function(t){e.$refs.video.srcObject=t})).catch((function(e){console.log(e)}))},stopCameraStream:function(){this.isVideoActive=!1,this.$refs.video.srcObject.getTracks().forEach((function(e){e.stop()}))}}},_=Object(n.a)(p,m,[],!1,null,"b2c10bd8",null);_.options.__file="src/components/ClonedVideo.vue";var v=_.exports,h=function(){var e=this.$createElement;this._self._c;return this._m(0)};h._withStripped=!0;var f={name:"GuestHeader"},g=Object(n.a)(f,h,[function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"guest-header"},[t("div",{staticClass:"guest-header__container"},[t("div",{staticClass:"guest-header__wrapper"},[t("h1",{staticClass:"guest-header__heading"},[this._v("AIJ: общение на стенде")]),t("div",{staticClass:"guest-header__bage"},[t("div",{staticClass:"guest-header__live-icon"}),t("p",{staticClass:"guest-header__live"},[this._v("LIVE")])])])])])}],!1,null,null,null);g.options.__file="src/layouts/GuestHeader.vue";var C=g.exports,b=a(180),S=a.n(b),w={name:"Guest",props:["roomName"],components:{StartStreamButton:u.a,VideoCheck:d.a,TalkToSpeakerPopup:c,ClonedVideo:v,GuestHeader:C},data:function(){return{isYourStreamStarted:!1,guestVideoId:"guestVideo",myVideoId:"myVideo",actualQuestion:"",showPopup:!1,devicesAllowed:!1,isMicOn:!0,isCameraOn:!0,hasGuest:!1,hasSpeaker:!1,myStreamId:null,guestStreamId:null,speakerStreamId:null,published:!1,webRTCAdaptor:void 0}},mounted:function(){S.a.debounce(this.initGuestWebRTCAdaptor,500)()},methods:{showDialogWindow:function(){this.showPopup=!0},initGuestWebRTCAdaptor:function(){var e=this;this.webRTCAdaptor=new i.a({websocket_url:"wss://ant2.tooladigital.ru:5443/WebRTCAppEE/websocket",mediaConstraints:{video:!0,audio:!0},peerconnection_config:{iceServers:[{urls:"stun:stun.l.google.com:19302"}]},sdp_constraints:{OfferToReceiveAudio:!0,OfferToReceiveVideo:!0},localVideoId:"myVideo",isPlayMode:!1,debug:!1,callback:function(t,a){if("initialized"===t)e.log("INITIALIZED"),e.devicesAllowed=!0,e.webRTCAdaptor.joinRoom(e.roomName,e.myStreamId);else if("joinedTheRoom"===t)e.log("JOINED THE ROOM"),e.myStreamId=a.streamId,e.$refs.myVideo.srcObject=e.webRTCAdaptor.localStream,1===a.streams.length?(e.speakerStreamId=a.streams[0],e.webRTCAdaptor.play(e.speakerStreamId,null,e.roomNameBox)):2===a.streams.length&&(e.guestStreamId=a.streams[1],e.webRTCAdaptor.play(a.streams[1],null,e.roomNameBox),e.speakerStreamId=a.streams[0],e.webRTCAdaptor.play(a.streams[0],null,e.roomNameBox));else if("streamInformation"===t)e.webRTCAdaptor.play(e.roomName);else if("newStreamAvailable"===t)e.log("NEW STREAM AVAILABLE"),null===e.speakerStreamId||e.speakerStreamId===a.streamId?(e.$refs.speakerVideo.srcObject=a.stream,e.speakerStreamId=a.streamId,e.hasSpeaker=!0):null!==e.guestStreamId&&e.guestStreamId!==a.streamId||(e.$refs.guestVideo.srcObject=a.stream,e.guestStreamId=a.streamId,e.hasGuest=!0),e.webRTCAdaptor.play(a.streamId,null,e.roomNameBox);else if("streamJoined"===t)e.log("STREAM JOINED: "+a.streamId),e.webRTCAdaptor.play(a.streamId,null,e.roomName);else if("streamLeaved"===t){if(e.log("STREAM LEAVED: "+a.streamId),e.speakerStreamId===a.streamId)e.log("REMOVE SRC SPEAKER"),e.$refs.speakerVideo.srcObject=null,e.hasSpeaker=!1,e.speakerStreamId=null;else if(e.guestStreamId===a.streamId){e.log("REMOVE SRC GUEST"),document.getElementById("guestVideo").srcObject=null,e.hasGuest=!1,e.guestStreamId=null}}else"publish_started"===t?(e.log("PUBLISH STARTED"),e.published=!0):"publish_finished"===t?(e.log("PUBLISH FINISHED"),e.published=!1):"leavedFromRoom"===t?(e.log("LEAVED THE ROOM"),e.webRTCAdaptor.joinRoom(e.roomName,e.myStreamId)):"closed"===t&&e.log("CONNECTION CLOSED")},callbackError:function(t){"no_stream_exist"===t?e.log("NO STREAM EXIST"):"notSetRemoteDescription"===t?e.log("Getting codec incompatible or remote description error"):-1!==t.indexOf("NotAllowedError")||-1!==t.indexOf("PermissionDeniedError")?e.devicesAllowed=!1:e.log("error callback: "+JSON.stringify(t))}})},publish:function(){this.webRTCAdaptor.publish(this.myStreamId)},unpublish:function(){this.actualQuestion="",this.webRTCAdaptor.leaveFromRoom(this.roomName)},togglePublish:function(){this.isYourStreamStarted=!this.isYourStreamStarted,this.showPopup=!1,this.published?this.unpublish():this.publish()},toggleLocalCamera:function(){this.isCameraOn?this.turnOffLocalCamera():this.turnOnLocalCamera()},toggleLocalMic:function(){this.isMicOn?this.muteLocalMic():this.unmuteLocalMic()},turnOffLocalCamera:function(){this.webRTCAdaptor.turnOffLocalCamera(),this.isCameraOn=!1,this.sendNotificationEvent("CAM_TURNED_OFF")},turnOnLocalCamera:function(){this.webRTCAdaptor.turnOnLocalCamera(),this.isCameraOn=!0,this.sendNotificationEvent("CAM_TURNED_ON")},muteLocalMic:function(){this.webRTCAdaptor.muteLocalMic(),this.isMicOn=!1,this.sendNotificationEvent("MIC_MUTED")},unmuteLocalMic:function(){this.webRTCAdaptor.unmuteLocalMic(),this.isMicOn=!0,this.sendNotificationEvent("MIC_UNMUTED")},sendNotificationEvent:function(e){if(this.isDataChannelOpen){var t={streamId:this.publishStreamId,eventType:e};this.webRTCAdaptor.sendData(this.publishStreamId,JSON.stringify(t))}else this.log("Could not send the notification because data channel is not open.")},log:function(e){0}}},k=Object(n.a)(w,s,[],!1,null,null,null);k.options.__file="src/pages/Guest.vue";t.default=k.exports}}]);