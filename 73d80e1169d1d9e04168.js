(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{108:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));n(109),n(92),n(110),n(89),n(111),n(112),n(113),n(55),n(53),n(114),n(115),n(93),n(104);var o=n(105),a=n(106);function i(e){var t=function(){function e(t){Object(o.a)(this,e),this.streamId=t,this.totalBytesReceivedCount=0,this.totalBytesSent=0,this.packetsLost=0,this.fractionLost=0,this.startTime=0,this.lastBytesReceived=0,this.lastBytesSent=0,this.currentTimestamp=0,this.lastTime=0,this.timerId=0,this.firstByteSentCount=0,this.firstBytesReceivedCount=0,this.audioLevel=-1}return Object(a.a)(e,[{key:"averageOutgoingBitrate",get:function(){return Math.floor(8*(this.totalBytesSentCount-this.firstByteSentCount)/(this.currentTimestamp-this.startTime))}},{key:"averageIncomingBitrate",get:function(){return Math.floor(8*(this.totalBytesReceivedCount-this.firstBytesReceivedCount)/(this.currentTimestamp-this.startTime))}},{key:"currentOutgoingBitrate",get:function(){return Math.floor(8*(this.totalBytesSentCount-this.lastBytesSent)/(this.currentTimestamp-this.lastTime))}},{key:"currentIncomingBitrate",get:function(){return Math.floor(8*(this.totalBytesReceivedCount-this.lastBytesReceived)/(this.currentTimestamp-this.lastTime))}},{key:"currentTime",set:function(e){this.lastTime=this.currentTimestamp,this.currentTimestamp=e,0==this.startTime&&(this.startTime=e-1)}},{key:"totalBytesReceived",set:function(e){this.lastBytesReceived=this.totalBytesReceivedCount,this.totalBytesReceivedCount=e,0==this.firstBytesReceivedCount&&(this.firstBytesReceivedCount=e)}},{key:"totalBytesSent",set:function(e){this.lastBytesSent=this.totalBytesSentCount,this.totalBytesSentCount=e,0==this.firstByteSentCount&&(this.firstByteSentCount=e)}}]),e}(),n=this;for(var i in n.peerconnection_config=null,n.sdp_constraints=null,n.remotePeerConnection=new Array,n.remotePeerConnectionStats=new Array,n.remoteDescriptionSet=new Array,n.iceCandidateList=new Array,n.webSocketAdaptor=null,n.roomName=null,n.videoTrackSender=null,n.audioTrackSender=null,n.playStreamId=new Array,n.micGainNode=null,n.localStream=null,n.bandwidth=900,n.isMultiPeer=!1,n.multiPeerStreamId=null,n.roomTimerId=-1,n.isPlayMode=!1,n.debug=!1,n.publishMode="camera",n.candidateTypes=["udp","tcp"],n.desktopStream=null,n.camera_location="top",n.camera_margin=15,n.camera_percent=15,e)e.hasOwnProperty(i)&&(this[i]=e[i]);if(n.localVideo=document.getElementById(n.localVideoId),n.remoteVideo=document.getElementById(n.remoteVideoId),"camera"==n.mediaConstraints.video?n.publishMode="camera":"screen"==n.mediaConstraints.video?n.publishMode="screen":"screen+camera"==n.mediaConstraints.video&&(n.publishMode="screen+camera"),!("WebSocket"in window))return console.log("WebSocket not supported."),void n.callbackError("WebSocketNotSupported");if(void 0===navigator.mediaDevices&&0==n.isPlayMode)return console.log("Cannot open camera and mic because of unsecure context. Please Install SSL(https)"),void n.callbackError("UnsecureContext");if(this.setDesktopwithCameraSource=function(e,t,o,a){n.desktopStream=e,navigator.mediaDevices.getUserMedia({video:!0,audio:!1}).then((function(a){var i=document.createElement("canvas"),r=i.getContext("2d"),c=document.createElement("video");c.srcObject=e,c.play();var s=document.createElement("video");s.srcObject=a,s.play();var d=i.captureStream(15);d.addTrack(o.getAudioTracks()[0]),null==n.localStream?(e.addTrack(o.getAudioTracks()[0]),n.gotStream(d)):n.updateVideoTrack(d,t,n.mediaConstraints,onended,null),setInterval((function(){i.width=c.videoWidth,i.height=c.videoHeight,r.drawImage(c,0,0,i.width,i.height);var e,t=c.videoWidth*(n.camera_percent/100),o=s.videoHeight/s.videoWidth*t,a=i.width-t-n.camera_margin;e="top"==n.camera_location?n.camera_margin:i.height-o-n.camera_margin,r.drawImage(s,a,e,t,o)}),66)})).catch((function(e){n.callbackError(e.name,e.message)}))},this.prepareStreamTracks=function(e,t,o,a){var i=o.getAudioTracks();if(i.length>0&&o.removeTrack(i[0]),"undefined"!=t&&0!=t){var r={audio:t};navigator.mediaDevices.getUserMedia(r).then((function(t){var i=function(t){n.callback("screen_share_stopped"),n.setVideoCameraSource(a,e,null,!0)};"screen"==n.publishMode?n.updateVideoTrack(o,a,e,i,!0):"screen+camera"==n.publishMode?n.setDesktopwithCameraSource(o,a,t,i):(o.addTrack(t.getAudioTracks()[0]),n.gotStream(o))})).catch((function(e){n.callbackError(e.name,e.message)}))}else o.addTrack(audioStream.getAudioTracks()[0]),n.gotStream(o)},this.getUserMedia=function(e,t,o){"screen+camera"==n.publishMode||"screen"==n.publishMode?navigator.mediaDevices.getDisplayMedia(e).then((function(a){n.prepareStreamTracks(e,t,a,o)})).catch((function(e){if("NotAllowedError"===e.name)if(console.debug("Permission denied error"),n.callbackError("ScreenSharePermissionDenied"),null==n.localStream){n.openStream({video:!0,audio:!0})}else n.switchVideoCameraCapture(o);else n.callbackError(e.name,e.message)})):navigator.mediaDevices.getUserMedia(e).then((function(a){n.prepareStreamTracks(e,t,a,o)})).catch((function(e){n.callbackError(e.name,e.message)}))},this.openStream=function(e){n.mediaConstraints=e;var t=!1;void 0!==e.audio&&0!=e.audio&&(t=e.audio),void 0!==e.video?n.getUserMedia(e,t):(console.error("MediaConstraint video is not defined"),n.callbackError("media_constraint_video_not_defined"))},this.closeStream=function(){n.localStream.getVideoTracks().forEach((function(e){e.onended=null,e.stop()})),n.localStream.getAudioTracks().forEach((function(e){e.onended=null,e.stop()}))},this.checkBrowserScreenShareSupported=function(){(void 0!==navigator.mediaDevices&&navigator.mediaDevices.getDisplayMedia||navigator.getDisplayMedia)&&n.callback("browser_screen_share_supported")},n.checkBrowserScreenShareSupported(),this.isPlayMode||void 0===n.mediaConstraints||null!=this.localStream)null!=n.webSocketAdaptor&&0!=n.webSocketAdaptor.isConnected()||(n.webSocketAdaptor=new c);else if(void 0!==n.mediaConstraints.video&&0!=n.mediaConstraints.video)n.mediaConstraints.audio.mandatory?navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then((function(e){navigator.mediaDevices.getUserMedia(n.mediaConstraints).then((function(t){var o=new AudioContext,a=o.createGain();a.gain.value=1;var i=o.createMediaStreamDestination();o.createMediaStreamSource(t).connect(a),n.micGainNode=o.createGain(),n.micGainNode.gain.value=1,o.createMediaStreamSource(e).connect(n.micGainNode),a.connect(i),n.micGainNode.connect(i),t.removeTrack(t.getAudioTracks()[0]),i.stream.getAudioTracks().forEach((function(e){t.addTrack(e)})),console.debug("Running gotStream"),n.gotStream(t)})).catch((function(e){n.callbackError(e.name,e.message)}))})).catch((function(e){n.callbackError(e.name,e.message)})):n.openStream(n.mediaConstraints,n.mode);else{var r={audio:n.mediaConstraints.audio};navigator.mediaDevices.getUserMedia(r).then((function(e){n.gotStream(e)})).catch((function(e){n.callbackError(e.name,e.message)}))}function c(){var e=new WebSocket(n.websocket_url),t=!1,o=-1,a=function(){-1!=o&&(n.debug&&console.debug("Clearing ping message timer"),clearInterval(o),o=-1)};this.close=function(){e.close()},e.onopen=function(){n.debug&&console.log("websocket connected"),o=setInterval((function(){e.send(JSON.stringify({command:"ping"}))}),3e3),t=!0,n.callback("initialized")},this.send=function(t){0!=e.readyState&&2!=e.readyState&&3!=e.readyState?(e.send(t),console.log("sent message:"+t)):n.callbackError("WebSocketNotConnected")},this.isConnected=function(){return t},e.onmessage=function(e){var t=JSON.parse(e.data);"start"==t.command?(n.debug&&console.debug("received start command"),n.startPublishing(t.streamId)):"takeCandidate"==t.command?(n.debug&&(console.debug("received ice candidate for stream id "+t.streamId),console.debug(t.candidate)),n.takeCandidate(t.streamId,t.label,t.candidate)):"takeConfiguration"==t.command?(n.debug&&console.log("received remote description type for stream id: "+t.streamId+" type: "+t.type),n.takeConfiguration(t.streamId,t.sdp,t.type)):"stop"==t.command?(console.debug("Stop command received"),n.closePeerConnection(t.streamId)):"error"==t.command?n.callbackError(t.definition):"notification"==t.command?(n.callback(t.definition,t),"play_finished"!=t.definition&&"publish_finished"!=t.definition||n.closePeerConnection(t.streamId)):"streamInformation"==t.command||"roomInformation"==t.command?n.callback(t.command,t):"pong"==t.command?n.callback(t.command):"trackList"==t.command?n.callback(t.command,t):"connectWithNewId"==t.command?(n.multiPeerStreamId=t.streamId,n.join(t.streamId)):"peerMessageCommand"==t.command&&n.callback(t.command,t)},e.onerror=function(e){console.log(" error occured: "+JSON.stringify(e)),a(),n.callbackError(e)},e.onclose=function(e){t=!1,console.log("connection closed."),a(),n.callback("closed",e)}}this.enableMicInMixedAudio=function(e){null!=n.micGainNode&&(n.micGainNode.gain.value=e?1:0)},this.publish=function(e,t){var o={command:"publish",streamId:e,token:t,video:n.localStream.getVideoTracks().length>0,audio:n.localStream.getAudioTracks().length>0};n.webSocketAdaptor.send(JSON.stringify(o))},this.joinRoom=function(e,t){n.roomName=e;var o={command:"joinRoom",room:e,streamId:t};n.webSocketAdaptor.send(JSON.stringify(o))},this.play=function(e,t,o,a){n.playStreamId.push(e);var i={command:"play",streamId:e,token:t,room:o,trackList:a};n.webSocketAdaptor.send(JSON.stringify(i))},this.stop=function(e){n.closePeerConnection(e);var t={command:"stop",streamId:e};n.webSocketAdaptor.send(JSON.stringify(t))},this.join=function(e){var t={command:"join",streamId:e,multiPeer:n.isMultiPeer&&null==n.multiPeerStreamId,mode:n.isPlayMode?"play":"both"};n.webSocketAdaptor.send(JSON.stringify(t))},this.leaveFromRoom=function(e){n.roomName=e;var t={command:"leaveFromRoom",room:e};console.log("leave request is sent for "+e),null!=n.roomTimerId&&clearInterval(n.roomTimerId),n.webSocketAdaptor.send(JSON.stringify(t))},this.leave=function(e){var t={command:"leave",streamId:n.isMultiPeer&&null!=n.multiPeerStreamId?n.multiPeerStreamId:e};n.webSocketAdaptor.send(JSON.stringify(t)),n.closePeerConnection(e),n.multiPeerStreamId=null},this.getStreamInfo=function(e){var t={command:"getStreamInfo",streamId:e};this.webSocketAdaptor.send(JSON.stringify(t))},this.getRoomInfo=function(e,t){var o=this;n.roomTimerId=setInterval((function(){var n={command:"getRoomInfo",streamId:t,room:e};o.webSocketAdaptor.send(JSON.stringify(n))}),5e3)},this.enableTrack=function(e,t,n){var o={command:"enableTrack",streamId:e,trackId:t,enabled:n};this.webSocketAdaptor.send(JSON.stringify(o))},this.getTracks=function(e,t){n.playStreamId.push(e);var o={command:"getTrackList",streamId:e,token:t};n.webSocketAdaptor.send(JSON.stringify(o))},this.gotStream=function(e){n.localStream=e,n.localVideo.srcObject=e,null!=n.webSocketAdaptor&&0!=n.webSocketAdaptor.isConnected()||(n.webSocketAdaptor=new c),navigator.mediaDevices.enumerateDevices().then((function(e){var t=new Array;e.forEach((function(e){"audioinput"!=e.kind&&"videoinput"!=e.kind||t.push(e)})),n.callback("available_devices",t)})).catch((function(e){console.error("Cannot get devices -> error name: "+e.name+": "+e.message)}))},this.switchAudioInputSource=function(e,t){var o=n.localStream.getAudioTracks()[0];o?o.stop():console.warn("There is no audio track in local stream"),void 0!==t&&(n.mediaConstraints.audio={deviceId:t}),n.setAudioInputSource(e,n.mediaConstraints,null,!0,t)},this.switchVideoCameraCapture=function(e,t){var o=n.localStream.getVideoTracks()[0];o?o.stop():console.warn("There is no video track in local stream"),n.publishMode="camera",void 0!==t&&(n.mediaConstraints.video={deviceId:t}),n.setVideoCameraSource(e,n.mediaConstraints,null,!0,t)},this.switchDesktopCapture=function(e){n.publishMode="screen";var t=!1;void 0!==mediaConstraints.audio&&0!=mediaConstraints.audio&&(t=mediaConstraints.audio),n.getUserMedia(n.mediaConstraints,t,e)},this.switchDesktopCaptureWithCamera=function(e){n.publishMode="screen+camera";var t=!1;void 0!==n.mediaConstraints.audio&&0!=n.mediaConstraints.audio&&(t=n.mediaConstraints.audio),n.getUserMedia(n.mediaConstraints,t,e)},n.updateLocalAudioStream=function(e,t){var o=n.localStream.getAudioTracks()[0];n.localStream.removeTrack(o),o.stop(),n.localStream.addTrack(e.getAudioTracks()[0]),n.localVideo.srcObject=n.localStream,null!=t&&(e.getAudioTracks()[0].onended=function(e){t(e)})},n.updateLocalVideoStream=function(e,t,o){o&&null!=n.desktopStream&&n.desktopStream.getVideoTracks()[0].stop();var a=n.localStream.getVideoTracks()[0];n.localStream.removeTrack(a),a.stop(),n.localStream.addTrack(e.getVideoTracks()[0]),n.localVideo.srcObject=n.localStream,null!=t&&(e.getVideoTracks()[0].onended=function(e){t(e)})},this.setAudioInputSource=function(e,t,o){navigator.mediaDevices.getUserMedia(t).then((function(a){n.updateAudioTrack(a,e,t,o)})).catch((function(e){n.callbackError(e.name)}))},this.setVideoCameraSource=function(e,t,o,a){navigator.mediaDevices.getUserMedia(t).then((function(i){n.updateVideoTrack(i,e,t,o,a)})).catch((function(e){n.callbackError(e.name)}))},this.updateAudioTrack=function(e,t,o,a){if(null!=n.remotePeerConnection[t]){var i=n.remotePeerConnection[t].getSenders().find((function(e){return"audio"==e.track.kind}));i?i.replaceTrack(e.getAudioTracks()[0]).then((function(t){n.updateLocalAudioStream(e,a)})).catch((function(e){console.log(e.name)})):console.error("AudioTrackSender is undefined or null")}else n.updateLocalAudioStream(e,a)},this.updateVideoTrack=function(e,t,o,a,i){if(null!=n.remotePeerConnection[t]){var r=n.remotePeerConnection[t].getSenders().find((function(e){return"video"==e.track.kind}));r?r.replaceTrack(e.getVideoTracks()[0]).then((function(t){n.updateLocalVideoStream(e,a,i)})).catch((function(e){console.log(e.name)})):console.error("VideoTrackSender is undefined or null")}else n.updateLocalVideoStream(e,a,i)},this.onTrack=function(e,t){if(console.log("onTrack"),null!=n.remoteVideo)n.remoteVideo.srcObject!==e.streams[0]&&(n.remoteVideo.srcObject=e.streams[0],console.log("Received remote stream"));else{var o={stream:e.streams[0],track:e.track,streamId:t};n.callback("newStreamAvailable",o)}},this.iceCandidateReceived=function(e,t){if(e.candidate){var o=!1;if(""==e.candidate.candidate?o=!0:void 0===e.candidate.protocol?n.candidateTypes.forEach((function(t){e.candidate.candidate.toLowerCase().includes(t)&&(o=!0)})):o=n.candidateTypes.includes(e.candidate.protocol.toLowerCase()),o){var a={command:"takeCandidate",streamId:t,label:e.candidate.sdpMLineIndex,id:e.candidate.sdpMid,candidate:e.candidate.candidate};n.debug&&(console.log("sending ice candiate for stream Id "+t),console.log(JSON.stringify(e.candidate))),n.webSocketAdaptor.send(JSON.stringify(a))}else console.log("Candidate's protocol(full sdp: "+e.candidate.candidate+") is not supported. Supported protocols: "+n.candidateTypes),""!=e.candidate.candidate&&n.callbackError("protocol_not_supported","Support protocols: "+n.candidateTypes.toString()+" candidate: "+e.candidate.candidate)}else console.log("No event.candidate in the iceCandidate event")},this.initDataChannel=function(e,t){t.onerror=function(o){console.log("Data Channel Error:",o);var a={streamId:e,error:o};console.log("channel status: ",t.readyState),"closed"!=t.readyState&&n.callbackError("data_channel_error",a)},t.onmessage=function(t){var o={streamId:e,event:t};n.callback("data_received",o)},t.onopen=function(){n.remotePeerConnection[e].dataChannel=t,console.log("Data channel is opened"),n.callback("data_channel_opened",e)},t.onclose=function(){console.log("Data channel is closed"),n.callback("data_channel_closed",e)}},this.initPeerConnection=function(e,t){if(null==n.remotePeerConnection[e]){var o=e;if(console.log("stream id in init peer connection: "+e+" close stream id: "+o),n.remotePeerConnection[e]=new RTCPeerConnection(n.peerconnection_config),n.remoteDescriptionSet[e]=!1,n.iceCandidateList[e]=new Array,n.playStreamId.includes(e)||null!=n.localStream&&n.remotePeerConnection[e].addStream(n.localStream),n.remotePeerConnection[e].onicecandidate=function(e){n.iceCandidateReceived(e,o)},n.remotePeerConnection[e].ontrack=function(e){n.onTrack(e,o)},"publish"==t){if(n.remotePeerConnection[e].createDataChannel){var a=n.remotePeerConnection[e].createDataChannel(e,{ordered:!0});n.initDataChannel(e,a)}else console.warn("CreateDataChannel is not supported")}else if("play"==t)n.remotePeerConnection[e].ondatachannel=function(t){n.initDataChannel(e,t.channel)};else{if(n.remotePeerConnection[e].createDataChannel){var i=n.remotePeerConnection[e].createDataChannel(e,{ordered:!0});n.initDataChannel(e,i),n.remotePeerConnection[e].ondatachannel=function(t){n.initDataChannel(e,t.channel)}}else console.warn("CreateDataChannel is not supported")}n.remotePeerConnection[e].oniceconnectionstatechange=function(t){var o={state:n.remotePeerConnection[e].iceConnectionState,streamId:e};n.callback("ice_connection_state_changed",o),n.isPlayMode||"connected"==n.remotePeerConnection[e].iceConnectionState&&n.changeBandwidth(n.bandwidth,e).then((function(){console.log("Bandwidth is changed to "+n.bandwidth)})).catch((function(e){return console.error(e)}))}}},this.closePeerConnection=function(e){if(null!=n.remotePeerConnection[e]&&(null!=n.remotePeerConnection[e].dataChannel&&n.remotePeerConnection[e].dataChannel.close(),"closed"!=n.remotePeerConnection[e].signalingState)){n.remotePeerConnection[e].close(),n.remotePeerConnection[e]=null,delete n.remotePeerConnection[e];var t=n.playStreamId.indexOf(e);-1!=t&&n.playStreamId.splice(t,1)}null!=n.remotePeerConnectionStats[e]&&(clearInterval(n.remotePeerConnectionStats[e].timerId),delete n.remotePeerConnectionStats[e])},this.signallingState=function(e){return null!=n.remotePeerConnection[e]?n.remotePeerConnection[e].signalingState:null},this.iceConnectionState=function(e){return null!=n.remotePeerConnection[e]?n.remotePeerConnection[e].iceConnectionState:null},this.gotDescription=function(e,t){n.remotePeerConnection[t].setLocalDescription(e).then((function(o){console.debug("Set local description successfully for stream Id "+t);var a={command:"takeConfiguration",streamId:t,type:e.type,sdp:e.sdp};n.debug&&(console.debug("local sdp: "),console.debug(e.sdp)),n.webSocketAdaptor.send(JSON.stringify(a))})).catch((function(e){console.error("Cannot set local description. Error is: "+e)}))},this.turnOffLocalCamera=function(){null!=n.remotePeerConnection?n.localStream.getVideoTracks()[0].enabled=!1:this.callbackError("NoActiveConnection")},this.turnOnLocalCamera=function(){null!=n.remotePeerConnection?n.localStream.getVideoTracks()[0].enabled=!0:this.callbackError("NoActiveConnection")},this.muteLocalMic=function(){null!=n.remotePeerConnection?n.localStream.getAudioTracks()[0].enabled=!1:this.callbackError("NoActiveConnection")},this.unmuteLocalMic=function(){null!=n.remotePeerConnection?n.localStream.getAudioTracks()[0].enabled=!0:this.callbackError("NoActiveConnection")},this.takeConfiguration=function(e,t,o){var a=e,i=o,r=t,c="offer"==i,s="publish";c&&(s="play"),n.initPeerConnection(a,s),n.remotePeerConnection[a].setRemoteDescription(new RTCSessionDescription({sdp:r,type:i})).then((function(e){n.debug&&(console.debug("set remote description is succesfull with response: "+e+" for stream : "+a+" and type: "+i),console.debug(r)),n.remoteDescriptionSet[a]=!0;var t=n.iceCandidateList[a].length;console.debug("Ice candidate list size to be added: "+t);for(var o=0;o<t;o++)n.addIceCandidate(a,n.iceCandidateList[a][o]);n.iceCandidateList[a]=[],c&&(console.log("try to create answer for stream id: "+a),n.remotePeerConnection[a].createAnswer(n.sdp_constraints).then((function(e){console.log("created answer for stream id: "+a),n.gotDescription(e,a)})).catch((function(e){console.error("create answer error :"+e)})))})).catch((function(e){n.debug&&console.error("set remote description is failed with error: "+e),(e.toString().indexOf("InvalidAccessError")>-1||e.toString().indexOf("setRemoteDescription")>-1)&&n.callbackError("notSetRemoteDescription")}))},this.takeCandidate=function(e,t,o){var a=e,i=new RTCIceCandidate({sdpMLineIndex:t,candidate:o});n.initPeerConnection(a,"peer"),1==n.remoteDescriptionSet[a]?n.addIceCandidate(a,i):(console.debug("Ice candidate is added to list because remote description is not set yet"),n.iceCandidateList[a].push(i))},this.addIceCandidate=function(e,t){var o=!1;""==t.candidate?o=!0:void 0===t.protocol?n.candidateTypes.forEach((function(e){t.candidate.toLowerCase().includes(e)&&(o=!0)})):o=n.candidateTypes.includes(t.protocol.toLowerCase()),o?n.remotePeerConnection[e].addIceCandidate(t).then((function(t){n.debug&&console.log("Candidate is added for stream "+e)})).catch((function(n){console.error("ice candiate cannot be added for stream id: "+e+" error is: "+n),console.error(t)})):n.debug&&console.log("Candidate's protocol("+t.protocol+") is not supported.Candidate: "+t.candidate+" Supported protocols:"+n.candidateTypes)},this.startPublishing=function(e){var t=e;n.initPeerConnection(t,"publish"),n.remotePeerConnection[t].createOffer(n.sdp_constraints).then((function(e){n.gotDescription(e,t)})).catch((function(e){console.error("create offer error for stream id: "+t+" error: "+e)}))},this.getVideoSender=function(e){var t=null;if(("chrome"===adapter.browserDetails.browser||"firefox"===adapter.browserDetails.browser&&adapter.browserDetails.version>=64)&&"RTCRtpSender"in window&&"setParameters"in window.RTCRtpSender.prototype)for(var o=n.remotePeerConnection[e].getSenders(),a=0;a<o.length;a++)if(null!=o[a].track&&"video"==o[a].track.kind){t=o[a];break}return t},this.changeBandwidth=function(e,t){var o="",a=n.getVideoSender(t);if(null!=a){var i=a.getParameters();return i.encodings||(i.encodings=[{}]),"unlimited"===e?delete i.encodings[0].maxBitrate:i.encodings[0].maxBitrate=1e3*e,a.setParameters(i)}return o="Video sender not found to change bandwidth",Promise.reject(o)},this.getStats=function(e){n.remotePeerConnection[e].getStats(null).then((function(t){var o=0,a=0,i=0,r=0,c=0,s=-1;t.forEach((function(e){"inbound-rtp"==e.type?(o+=e.bytesReceived,a+=e.packetsLost,i+=e.fractionLost,r=e.timestamp):"outbound-rtp"==e.type?(c+=e.bytesSent,r=e.timestamp):"track"==e.type&&void 0!==e.kind&&"audio"==e.kind&&void 0!==e.audioLevel&&(s=e.audioLevel)})),n.remotePeerConnectionStats[e].totalBytesReceived=o,n.remotePeerConnectionStats[e].packetsLost=a,n.remotePeerConnectionStats[e].fractionLost=i,n.remotePeerConnectionStats[e].currentTime=r,n.remotePeerConnectionStats[e].totalBytesSent=c,n.remotePeerConnectionStats[e].audioLevel=s,n.callback("updated_stats",n.remotePeerConnectionStats[e])}))},this.enableStats=function(e){n.remotePeerConnectionStats[e]=new t(e),n.remotePeerConnectionStats[e].timerId=setInterval((function(){n.getStats(e)}),5e3)},this.closeWebSocket=function(){for(var e in n.remotePeerConnection)n.remotePeerConnection[e].close();n.remotePeerConnection=new Array,n.webSocketAdaptor.close()},this.peerMessage=function(e,t,o){var a={command:"peerMessageCommand",streamId:e,definition:t,data:o};n.webSocketAdaptor.send(JSON.stringify(a))},this.forceStreamQuality=function(e,t){var o={command:"forceStreamQuality",streamId:e,streamHeight:t};n.webSocketAdaptor.send(JSON.stringify(o))},this.sendData=function(e,t){n.remotePeerConnection[e].dataChannel.send(t)}}}}]);