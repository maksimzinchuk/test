(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{17:function(e,t,i){e.exports=i.p+"images/65551b3f0b0b408c38d2280018774aa2.svg"},18:function(e,t,i){e.exports=i.p+"images/14e9195be4fd4fa9bf5024e894aec077.svg"},19:function(e,t,i){e.exports=i.p+"images/e1f9006d15a72ef14d88e977520f2ea5.svg"},20:function(e,t,i){e.exports=i.p+"images/f5786cb169e5fb1da1037b300bf3f159.svg"},26:function(e,t,i){"use strict";i.r(t);var s=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("div",{class:[e.published?"":"speaker_initial","speaker"]},[s("div",{staticClass:"speaker__container"},[s("div",{class:[e.published?"":"speaker__wrapper_initial","speaker__wrapper"]},[s("div",{class:[e.published?"":"speaker__wrap_initial","speaker__wrap"]},[s("video",{class:[e.published?"":"video-box_initial","video-box"],attrs:{id:"localVideo",autoplay:"",muted:"",playsinline:""},domProps:{muted:!0}})]),e.published?e._e():s("div",{staticClass:"initial__wrapper"},[s("VideoCheck",{attrs:{isCameraOn:e.isCameraOn},on:{toggleLocalCamera:e.toggleLocalCamera}}),s("StartStreamButton",{attrs:{title:"Начать трансляцию"},on:{toggleRoom:e.toggleRoom}})],1),e.published?s("div",[s("div",{staticClass:"settings"},[s("div",{staticClass:"settings__wrapper"},[s("div",{staticClass:"settings__item",on:{click:e.toggleLocalMic}},[s("div",{class:[e.isMicOn?"":"settings__round_disabled","settings__round"]},[s("img",{attrs:{src:i(17),alt:"mic"}})]),s("p",{staticClass:"settings__text"},[e._v("Микрофон")])]),s("div",{staticClass:"settings__item",on:{click:e.toggleLocalCamera}},[s("div",{class:[e.isCameraOn?"":"settings__round_disabled","settings__round"]},[s("img",{attrs:{src:i(18),alt:"cam"}})]),s("p",{staticClass:"settings__text"},[e._v("Камера")])]),s("div",{staticClass:"settings__item",on:{click:e.toggleDesktopCapture}},[e._m(0),s("p",{staticClass:"settings__text"},[e._v("Экран")])]),s("div",{staticClass:"settings__item",on:{click:e.leaveRoom}},[e._m(1),s("p",{staticClass:"settings__text"},[e._v("Выйти")])])])])]):e._e()]),e.published?s("div",{staticClass:"speaker__wrapper"},[s("div",{staticClass:"speaker__item"},[s("div",{staticClass:"speaker__wrap"},[s("div",{class:[e.guestVideoIsActive?"speaker__video_active":"","speaker__video"]},[e._m(2)])])])]):e._e()])])])},o=[function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"settings__round"},[t("img",{attrs:{src:i(19),alt:"screen"}})])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"settings__round"},[t("img",{attrs:{src:i(20),alt:"exit"}})])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{attrs:{id:"players"}},[t("video",{staticClass:"video-box",attrs:{id:"remoteVideo",autoplay:"",playsinline:""}})])}];s._withStripped=!0;var a=i(13),n=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",e._l(e.questions,(function(t,s){return i("div",{key:t.key,staticClass:"question"},[i("div",{staticClass:"question__wrapper"},[i("h2",{staticClass:"question__name"},[e._v(e._s(t.name))]),i("p",{ref:"question",refInFor:!0,staticClass:"question__text"},[e._v(e._s(t.question))]),i("div",{staticClass:"question__actions"},[i("p",{staticClass:"question__button question__button_accept",on:{click:function(i){return e.acceptDialog(t)}}},[e._v("Принять")]),i("p",{staticClass:"question__button question__button_decline"},[e._v("Отклонить")])])])])})),0)};n._withStripped=!0;var r={name:"Question",props:["questions"],methods:{acceptDialog(e){this.$emit("accept",e)}}},l=i(1),c=Object(l.a)(r,n,[],!1,null,null,null);c.options.__file="src/components/Question.vue";var d=c.exports,m=i(14),u=i(15),p={components:{VideoCheck:m.a,Question:d,StartStreamButton:u.a},data:()=>({guestVideoIsActive:!1,questions:[{name:"Руслан Иванов",question:"Как вы считаете, кто станет президентом в США? А что, если это будет Роналду?"},{name:"Иванов",question:"А что, если это будет Роналду?"}],activeQuestion:"",devicesAllowed:!1,isMicOn:!0,isCameraOn:!0,token:null,streamId:"null",playOnly:null,canJoin:!1,canDesktop:!0,isDesktop:!1,published:!1,roomNameBox:"TestRoom",roomOfStream:[],streamsList:[],publishStreamId:null,isDataChannelOpen:!1,pc_config:{iceServers:[{urls:"stun:stun.l.google.com:19302"}]},sdpConstraints:{OfferToReceiveAudio:!0,OfferToReceiveVideo:!0},mediaConstraints:{video:!0,audio:!0},websocketURL:"wss://ant2.tooladigital.ru:5443/WebRTCAppEE/websocket",webRTCAdaptor:void 0}),mounted(){this.init()},computed:{publicLink(){return"https://webrtc.tooladigital.ru/guest/"+this.roomNameBox},startBtnLabel(){return this.canJoin&&this.devicesAllowed?"START PUBLISH":this.published?"STOP PUBLISH":"NOT ALLOWED DEVICES"}},methods:{acceptDialog(e){const t=this.publicLink;window.open(t,"_blank"),this.activeQuestion=e},pushToGuest(){const e=this.$router.resolve({name:"guest",params:{roomName:this.roomNameBox}});window.open(e.href,"_blank")},init(){this.webRTCAdaptor=new a.a({websocket_url:this.websocketURL,mediaConstraints:{video:!0,audio:!0},peerconnection_config:{iceServers:[{urls:"stun:stun.l.google.com:19302"}]},sdp_constraints:{OfferToReceiveAudio:!1,OfferToReceiveVideo:!1},localVideoId:"localVideo",isPlayMode:this.playOnly,debug:!0,publishMode:"camera",callback:(e,t)=>{if("initialized"===e)console.log("initialized"),this.devicesAllowed=!0,this.canJoin=!0;else if("joinedTheRoom"===e)this.roomOfStream[t.streamId]=t.ATTR_ROOM_NAME,this.streamId=t.streamId,this.publish(t.streamId),null!=t.streams&&t.streams.forEach(e=>{this.webRTCAdaptor.play(e,null,this.roomNameBox)});else if("streamJoined"===e)this.webRTCAdaptor.play(t.streamId,null,this.roomNameBox);else if("newStreamAvailable"===e)this.playVideo(t);else if("streamLeaved"===e){this.guestVideoIsActive=!1;document.getElementById("remoteVideo").srcObject=null}else if("publish_started"===e)this.published=!0,this.canJoin=!1;else if("publish_finished"===e)this.published=!1,this.canJoin=!0;else if("play_finished"===e){const e=document.getElementById("remoteVideo"+t.streamId);null!=e&&(e.srcObject=null),this.webRTCAdaptor.getStreamInfo(t.streamId)}else"streamInformation"===e?this.streamInformation(t):console.log(e+" notification received")},callbackError:(e,t)=>{console.log("error callback: "+JSON.stringify(e));let i=JSON.stringify(e);void 0!==t&&(i=t),-1!==e.indexOf("NotFoundError")?i="Camera or Mic are not found or not allowed in your device.":-1!==e.indexOf("NotReadableError")||-1!==e.indexOf("TrackStartError")?i="Camera or Mic is being used by some other process that does not not allow these devices to be read.":-1!==e.indexOf("OverconstrainedError")||-1!==e.indexOf("ConstraintNotSatisfiedError")?i="There is no device found that fits your video and audio constraints. You may change video and audio constraints.":-1!==e.indexOf("NotAllowedError")||-1!==e.indexOf("PermissionDeniedError")?(i="You are not allowed to access camera and mic.",this.devicesAllowed=!1,this.canJoin=!1):-1!==e.indexOf("TypeError")?i="Video/Audio is required.":-1!==e.indexOf("UnsecureContext")?i="Fatal Error: Browser cannot access camera and mic because of unsecure context. Please install SSL and access via https":-1!==e.indexOf("WebSocketNotSupported")?i="Fatal Error: WebSocket not supported in this browser":-1!==e.indexOf("no_stream_exist")||(-1!==e.indexOf("data_channel_error")?i="There was a error during data channel communication":-1!==e.indexOf("ScreenSharePermissionDenied")&&(i="You are not allowed to access screen share",this.isDesktop=!1,this.canDesktop=!1)),console.debug(i)}})},toggleDesktopCapture(){this.isDesktop?(this.webRTCAdaptor.switchVideoCameraCapture(this.streamId),this.isDesktop=!1):(this.webRTCAdaptor.switchDesktopCaptureWithCamera(this.streamId),this.isDesktop=!0)},toggleRoom(){this.canJoin?this.joinRoom():this.leaveRoom()},joinRoom(){this.webRTCAdaptor.joinRoom(this.roomNameBox,this.streamId),this.canJoin=!1},leaveRoom(){this.webRTCAdaptor.leaveFromRoom(this.roomNameBox),this.canJoin=!0;for(const e in document.getElementById("players").childNodes)"DIV"===e.tagName&&"localVideo"!==e.id&&document.getElementById("players").removeChild(e)},toggleLocalCamera(){this.isCameraOn?this.turnOffLocalCamera():this.turnOnLocalCamera()},toggleLocalMic(){this.isMicOn?this.muteLocalMic():this.unmuteLocalMic()},turnOffLocalCamera(){this.webRTCAdaptor.turnOffLocalCamera(),this.isCameraOn=!1,this.sendNotificationEvent("CAM_TURNED_OFF")},turnOnLocalCamera(){this.webRTCAdaptor.turnOnLocalCamera(),this.isCameraOn=!0,this.sendNotificationEvent("CAM_TURNED_ON")},muteLocalMic(){this.webRTCAdaptor.muteLocalMic(),this.isMicOn=!1,this.sendNotificationEvent("MIC_MUTED")},unmuteLocalMic(){this.webRTCAdaptor.unmuteLocalMic(),this.isMicOn=!0,this.sendNotificationEvent("MIC_UNMUTED")},sendNotificationEvent(e){if(this.isDataChannelOpen){const t={streamId:this.publishStreamId,eventType:e};this.webRTCAdaptor.sendData(this.publishStreamId,JSON.stringify(t))}else console.log("Could not send the notification because data channel is not open.")},publish(e){this.publishStreamId=e,this.webRTCAdaptor.publish(e)},playVideo(e){this.guestVideoIsActive=!0;document.getElementById("remoteVideo").srcObject=e.stream},createRemoteVideo(e){const t=document.createElement("div");t.className="col-sm-3",t.id="player"+e,t.innerHTML='<video id="remoteVideo'+e+'"autoplay style="max-height: 258px; max-width: 344px;"></video>',document.getElementById("players").appendChild(t)},removeRemoteVideo(e){const t=document.getElementById("remoteVideo"+e);if(null!=t){const i=document.getElementById("player"+e);t.srcObject=null,document.getElementById("players").removeChild(i)}},streamInformation(e){this.webRTCAdaptor.play(e.streamId,null,this.roomNameBox)},handleNotificationEvent(e){const t=JSON.parse(e.event.data);if(null!=t&&"object"==typeof t){const e=t.streamId,i=t.eventType;"CAM_TURNED_OFF"===i?console.log("Camera turned off for: ",e):"CAM_TURNED_ON"===i?console.log("Camera turned on for: ",e):"MIC_MUTED"===i?console.log("Microphone muted for: ",e):"MIC_UNMUTED"===i&&console.log("Microphone unmuted for: ",e)}}}},h=Object(l.a)(p,s,o,!1,null,null,null);h.options.__file="src/pages/Index.vue";t.default=h.exports}}]);